<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/2.9.0/metricsgraphics.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/2.9.0/metricsgraphics.min.js"></script>

<div id="charts"></div>
<script>
  fetch(`/dashboard/stats/stats.json`)
    .then(response => response.json())
    .then(stats => {
      const charts = Object.keys(stats[0])
        .filter(
          label => label !== "date" && typeof stats[0][label] === "number"
        )
        .sort()
        .map(label => {
          const data = stats.map(i => ({
            date: new Date(i.date),
            value: i[label]
          }));

          return {
            label,
            type: "line",
            legend: ["value"],
            data
          };
        });

      charts.forEach(chart => {
        const chartNode = document.createElement("div");
        document.getElementById("charts").appendChild(chartNode);

        MG.data_graphic({
          data: chart.data,
          chart_type: chart.type || "line",
          top: 100,
          width: 1000,
          height: 400,
          right: 90,
          bottom: 90,
          left: 100,
          brush: "xy",
          area: true,
          target: chartNode,
          legend: chart.legend,
          y_label: chart.label,
          yAxis: {
            extendedTicks: true
          }
        });
      });
    });
</script>
