<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/2.9.0/metricsgraphics.min.css"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/2.9.0/metricsgraphics.min.js"></script>

<div id="charts"></div>
<script>
  fetch(`/dashboard/stats/stats.json`)
    .then((response) => response.json())
    .then((charts) => {
      charts.forEach((chart) => {
        const chartNode = document.createElement("div");
        document.getElementById("charts").appendChild(chartNode);

        const data = chart.data.map((d) => {
          if (Array.isArray(d[0])) {
            return d.map((d) => ({ value: d[1], date: new Date(d[0]) }));
          } else {
            return { value: d[1], date: new Date(d[0]) };
          }
        });
        
        console.log(data);

        MG.data_graphic({
          data,
          chart_type: chart.type || "line",
          top: 100,
          width: 1000,
          height: 400,
          right: 90,
          bottom: 90,
          left: 100,
          brush: 'xy',
          area: true,
          target: chartNode,
          legend: chart.legend,
          y_label: chart.label,
          yAxis: {
            extendedTicks: true,
          },
        });
      });
    });
</script>
